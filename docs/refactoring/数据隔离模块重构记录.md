# æ•°æ®éš”ç¦»æ¨¡å—é‡æ„è®°å½•

## ğŸ“‹ é‡æ„æ¦‚è¿°

å°† `DataAccessDeniedEvent` ä» `events` ç›®å½•ç§»åŠ¨åˆ° `isolation` ç›®å½•ï¼Œä»¥æ›´å¥½åœ°ç»„ç»‡æ•°æ®éš”ç¦»ç›¸å…³çš„ä»£ç ã€‚

## ğŸ”„ å˜æ›´å†…å®¹

### æ–‡ä»¶ç§»åŠ¨

- **åŸä½ç½®**: `libs/domain-kernel/src/events/data-access-denied.event.ts`
- **æ–°ä½ç½®**: `libs/domain-kernel/src/isolation/data-access-denied.event.ts`

### æ–‡ä»¶å¢å¼º

åœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¯¹ `DataAccessDeniedEvent` è¿›è¡Œäº†å¢å¼ºï¼š

1. **æ·»åŠ äº†å®Œæ•´çš„TSDocæ³¨é‡Š**
2. **å¢åŠ äº†ä¸šåŠ¡è§„åˆ™è¯´æ˜**
3. **æ·»åŠ äº†ä½¿ç”¨ç¤ºä¾‹**
4. **å¢åŠ äº† `toString()` å’Œ `toJSON()` æ–¹æ³•**

### å¯¼å‡ºæ›´æ–°

1. **æ›´æ–°äº† `libs/domain-kernel/src/isolation/index.ts`**ï¼š

   ```typescript
   // äº‹ä»¶
   export { IsolationContextCreatedEvent } from "./context-created.event.js";
   export { IsolationContextSwitchedEvent } from "./context-switched.event.js";
   export { DataAccessDeniedEvent } from "./data-access-denied.event.js"; // æ–°å¢
   ```

2. **æ›´æ–°äº† `libs/domain-kernel/src/index.ts`**ï¼š

   ```typescript
   // é¢†åŸŸäº‹ä»¶
   export { DomainEvent as DomainEventBase } from "./events/domain-event.js";
   // æ³¨æ„ï¼šéš”ç¦»ç›¸å…³äº‹ä»¶ï¼ˆåŒ…æ‹¬DataAccessDeniedEventï¼‰å·²é€šè¿‡ isolation æ¨¡å—å¯¼å‡º
   ```

3. **æ›´æ–°äº† `libs/domain-kernel/README.md`**ï¼š
   - æ›´æ–°äº†äº‹ä»¶åˆ—è¡¨ï¼Œæ ‡æ³¨äº† `DataAccessDeniedEvent` çš„æ–°ä½ç½®

## ğŸ“ å½“å‰ isolation æ¨¡å—ç»“æ„

```
libs/domain-kernel/src/isolation/
â”œâ”€â”€ isolation-context.entity.ts          # éš”ç¦»ä¸Šä¸‹æ–‡å®ä½“
â”œâ”€â”€ isolation-level.enum.ts              # éš”ç¦»çº§åˆ«æšä¸¾
â”œâ”€â”€ sharing-level.enum.ts                # å…±äº«çº§åˆ«æšä¸¾
â”œâ”€â”€ isolation-validation.error.ts        # éš”ç¦»éªŒè¯é”™è¯¯
â”œâ”€â”€ data-access-context.interface.ts     # æ•°æ®è®¿é—®ä¸Šä¸‹æ–‡æ¥å£
â”œâ”€â”€ isolation-context-provider.interface.ts # éš”ç¦»ä¸Šä¸‹æ–‡æä¾›è€…æ¥å£
â”œâ”€â”€ isolation-validator.interface.ts     # éš”ç¦»éªŒè¯å™¨æ¥å£
â”œâ”€â”€ context-created.event.ts             # ä¸Šä¸‹æ–‡åˆ›å»ºäº‹ä»¶
â”œâ”€â”€ context-switched.event.ts            # ä¸Šä¸‹æ–‡åˆ‡æ¢äº‹ä»¶
â”œâ”€â”€ data-access-denied.event.ts          # æ•°æ®è®¿é—®æ‹’ç»äº‹ä»¶ï¼ˆæ–°ç§»åŠ¨ï¼‰
â””â”€â”€ index.ts                             # ç»Ÿä¸€å¯¼å‡ºæ–‡ä»¶
```

## ğŸ¯ é‡æ„ä¼˜åŠ¿

### 1. **æ›´å¥½çš„ä»£ç ç»„ç»‡**

- æ‰€æœ‰æ•°æ®éš”ç¦»ç›¸å…³çš„ç»„ä»¶ç°åœ¨éƒ½åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹
- ä¾¿äºå¼€å‘è€…æ‰¾åˆ°å’Œä½¿ç”¨ç›¸å…³åŠŸèƒ½

### 2. **æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ**

- `events` ç›®å½•ä¸“æ³¨äºé€šç”¨é¢†åŸŸäº‹ä»¶
- `isolation` ç›®å½•ä¸“æ³¨äºæ•°æ®éš”ç¦»ç›¸å…³åŠŸèƒ½

### 3. **ä¸€è‡´çš„å¯¼å…¥è·¯å¾„**

- æ‰€æœ‰éš”ç¦»ç›¸å…³åŠŸèƒ½éƒ½é€šè¿‡ `@hl8/domain-kernel/isolation` å¯¼å…¥
- ç®€åŒ–äº†ä¾èµ–ç®¡ç†

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å¯¼å…¥æ–¹å¼

```typescript
// æ–°çš„å¯¼å…¥æ–¹å¼ï¼ˆæ¨èï¼‰
import {
  DataAccessDeniedEvent,
  IsolationContext,
  IsolationLevel,
} from "@hl8/domain-kernel";

// æˆ–è€…ç›´æ¥ä» isolation æ¨¡å—å¯¼å…¥
import {
  DataAccessDeniedEvent,
  IsolationContext,
  IsolationLevel,
} from "@hl8/domain-kernel/isolation";
```

### ä½¿ç”¨ç¤ºä¾‹

```typescript
// åˆ›å»ºæ•°æ®è®¿é—®æ‹’ç»äº‹ä»¶
const event = new DataAccessDeniedEvent(
  "user-123",
  "data-456",
  "User level context cannot access organization level data",
  new Date(),
);

// å‘å¸ƒäº‹ä»¶
eventBus.publish(event);

// è·å–äº‹ä»¶æè¿°
console.log(event.toString());
// è¾“å‡º: "DataAccessDeniedEvent: User user-123 denied access to data data-456. Reason: User level context cannot access organization level data"

// è·å–JSONè¡¨ç¤º
console.log(event.toJSON());
// è¾“å‡º: { type: 'DataAccessDeniedEvent', userId: 'user-123', dataId: 'data-456', ... }
```

## âœ… éªŒè¯ç»“æœ

1. **ç¼–è¯‘é€šè¿‡**: æ–°çš„æ–‡ä»¶ä½ç½®ç¼–è¯‘æ— é”™è¯¯
2. **å¯¼å‡ºæ­£ç¡®**: æ‰€æœ‰å¯¼å‡ºè·¯å¾„å·²æ­£ç¡®æ›´æ–°
3. **å‘åå…¼å®¹**: é€šè¿‡ `isolation` æ¨¡å—çš„å¯¼å‡ºä¿æŒäº†å‘åå…¼å®¹æ€§
4. **æ–‡æ¡£æ›´æ–°**: README å’Œæ³¨é‡Šå·²åŒæ­¥æ›´æ–°

## ğŸ”„ åç»­å»ºè®®

1. **è€ƒè™‘å…¶ä»–äº‹ä»¶**: æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–äº‹ä»¶åº”è¯¥ç§»åŠ¨åˆ° `isolation` ç›®å½•
2. **ç»Ÿä¸€å‘½å**: è€ƒè™‘å°†æ‰€æœ‰éš”ç¦»ç›¸å…³çš„äº‹ä»¶ä½¿ç”¨ç»Ÿä¸€çš„å‘½åå‰ç¼€
3. **æµ‹è¯•è¦†ç›–**: ä¸ºç§»åŠ¨åçš„äº‹ä»¶æ·»åŠ å®Œæ•´çš„å•å…ƒæµ‹è¯•

---

_é‡æ„å®Œæˆæ—¶é—´ï¼š2024å¹´1æœˆ_
